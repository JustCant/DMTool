var app=angular.module("hpTracker",[]);app.service("appService",function(){this.char={},this.playerChars=[],this.enemyChars=[],this.localChars=[]}),app.controller("adderCtrl",["$scope","appService",function(e,t){e.appService=t,e.addChar=function(e){if(t.char.name&&t.char.hitPoints){let n=(new Date).getTime();"hero"===e?(t.char.type="hero",t.playerChars.push(t.char)):"enemy"===e&&(t.char.type="enemy",t.enemyChars.push(t.char)),t.char.id=n,t.char.armorClass=null,t.char.initiative=null,t.char.maxHp=t.char.hitPoints,t.localChars.push(t.char),localStorage.setItem(`${t.char.id}`,JSON.stringify(t.char)),setTimeout(function(){t.char={},console.log("reset")},1e3)}}}]),app.controller("characterCtrl",["$scope","appService",function(e,t){if(localStorage.length>0)for(let e=0;e<localStorage.length;e++){let n=JSON.parse(localStorage.getItem(localStorage.key(e)));t.localChars.push(n),"hero"===n.type?t.playerChars.push(n):"enemy"===n.type&&t.enemyChars.push(n)}else console.log("Nothing in local Storage");if(0===t.playerChars.length){let e={name:"Mario",hitPoints:100,maxHp:100,initiative:"",armorClass:15,type:"hero",show:!1,popupShow:!1,id:"Mario"};t.playerChars.push(e),localStorage.setItem("Mario",JSON.stringify(e))}if(0===t.enemyChars.length){let e={name:"King Bowser",hitPoints:250,maxHp:250,initiative:"",armorClass:18,type:"enemy",show:!1,popupShow:!1,id:"Bowser"};t.enemyChars.push(e),localStorage.setItem("Bowser",JSON.stringify(e))}}]),app.controller("enemyCtrl",["$scope","appService",function(e,t){e.appService=t,e.addEnemyCopies=function(e,n){let i=parseInt(e),l=n[0],a=$("#enemyCopyInput").val();if(l){if(""===a||isNaN(parseInt(a)))return;for(let e=1;e<=i;e++){let i=(new Date).getTime()*Math.random();t.char.id=i,t.char.name=n[0].name+" copy "+e,t.char.type=n[0].type,t.char.hitPoints=n[0].hitPoints,t.char.show=!1,t.char.popupShow=!1,t.char.armorClass=null,t.char.initiative=null,t.char.maxHp=n[0].hitPoints,t.enemyChars.push(t.char),t.localChars.push(t.char),localStorage.setItem(`${t.char.id}`,JSON.stringify(t.char)),t.char={}}}else if(!l)return},e.clearAllEnemies=function(){let e=localStorage.length;t.enemyChars=[];for(let t=e-1;t>=0;t--){let e=JSON.parse(localStorage.getItem(localStorage.key(t)));"enemy"===e.type&&localStorage.removeItem(e.id)}},e.checkValidName=function(e){""!==e.name&&localStorage.setItem(`${e.id}`,JSON.stringify(e))},e.checkValidAc=function(e){null!==e.armorClass&&localStorage.setItem(`${e.id}`,JSON.stringify(e))},e.checkValidMaxHp=function(e){null!==e.maxHp&&localStorage.setItem(`${e.id}`,JSON.stringify(e))},e.checkValidHp=function(e){null!==e.hitPoints&&localStorage.setItem(`${e.id}`,JSON.stringify(e))},e.save=function(e){""!==e.name&&null!==e.armorClass&&null!==e.maxHp&&null!==e.hitPoints&&localStorage.setItem(`${e.id}`,JSON.stringify(e))},e.increment=function(e,t){e.hitPoints=parseInt(e.hitPoints),e.hitPoints+=t,localStorage.setItem(`${e.id}`,JSON.stringify(e))},e.decrement=function(e,t){e.hitPoints=parseInt(e.hitPoints),e.hitPoints-=t,localStorage.setItem(`${e.id}`,JSON.stringify(e))},e.activate=function(e,t){switch(t){case 0:e.blinded=!e.blinded;break;case 1:e.charmed=!e.charmed;break;case 2:e.deafened=!e.deafened;break;case 3:e.dodge=!e.dodge;break;case 4:e.exhausted=!e.exhausted;break;case 5:e.frightened=!e.frightened;break;case 6:e.grappled=!e.grappled;break;case 7:e.hidden=!e.hidden;break;case 8:e.incapacitated=!e.incapacitated;break;case 9:e.invisible=!e.invisible;break;case 10:e.paralyzed=!e.paralyzed;break;case 11:e.petrified=!e.petrified;break;case 12:e.poisoned=!e.poisoned;break;case 13:e.prone=!e.prone;break;case 14:e.restrained=!e.restrained;break;case 15:e.stunned=!e.stunned;break;case 16:e.unconcious=!e.unconcious}localStorage.setItem(`${e.id}`,JSON.stringify(e))},e.deleteEnemy=function(e,t){let n=t.indexOf(e);t.splice(n,1),localStorage.removeItem(`${e.id}`)}}]),app.controller("initiativeCtrl",["$scope","appService",function(e,t){e.appService=t,e.reset=function(){let e;for(e in t.localChars)t.localChars[e].initiative="",t.localChars[e].init=!1,localStorage.setItem(`${t.localChars[e].id}`,JSON.stringify(t.localChars[e]));return t.localChars},e.setInitiative=function(e){return localStorage.setItem(`${e.id}`,JSON.stringify(e)),JSON.parse(localStorage.getItem(`${e.id}`))}}]),app.controller("playerCtrl",["$scope","appService",function(e,t){e.appService=t,e.addHeroCopies=function(e,n){let i=parseInt(e),l=n[0],a=$("#heroCopyInput").val();if(l){if(""===a||isNaN(parseInt(a)))return;for(let e=1;e<=i;e++){let i=(new Date).getTime()*Math.random();t.char.id=i,t.char.name=n[0].name+" copy "+e,t.char.type=n[0].type,t.char.hitPoints=n[0].hitPoints,t.char.show=!1,t.char.popupShow=!1,t.char.armorClass=n[0].armorClass,t.char.initiative=null,t.char.maxHp=n[0].hitPoints,t.playerChars.push(t.char),t.localChars.push(t.char),localStorage.setItem(`${t.char.id}`,JSON.stringify(t.char)),t.char={}}}else if(!l)return},e.clearAllHeroes=function(){let e=localStorage.length;t.playerChars=[];for(let t=e-1;t>=0;t--){let e=JSON.parse(localStorage.getItem(localStorage.key(t)));"hero"===e.type&&localStorage.removeItem(e.id)}},e.checkValidName=function(e){""!==e.name&&localStorage.setItem(`${e.id}`,JSON.stringify(e))},e.checkValidAc=function(e){null!==e.armorClass&&localStorage.setItem(`${e.id}`,JSON.stringify(e))},e.checkValidMaxHp=function(e){null!==e.maxHp&&localStorage.setItem(`${e.id}`,JSON.stringify(e))},e.checkValidHp=function(e){null!==e.hitPoints&&localStorage.setItem(`${e.id}`,JSON.stringify(e))},e.save=function(e){""!==e.name&&null!==e.armorClass&&null!==e.maxHp&&null!==e.hitPoints&&localStorage.setItem(`${e.id}`,JSON.stringify(e))},e.increment=function(e,t){e.hitPoints=parseInt(e.hitPoints),e.hitPoints+=t,localStorage.setItem(`${e.id}`,JSON.stringify(e))},e.decrement=function(e,t){e.hitPoints=parseInt(e.hitPoints),e.hitPoints-=t,localStorage.setItem(`${e.id}`,JSON.stringify(e))},e.activate=function(e,t){switch(t){case 0:e.blinded=!e.blinded;break;case 1:e.charmed=!e.charmed;break;case 2:e.deafened=!e.deafened;break;case 3:e.dodge=!e.dodge;break;case 4:e.exhausted=!e.exhausted;break;case 5:e.frightened=!e.frightened;break;case 6:e.grappled=!e.grappled;break;case 7:e.hidden=!e.hidden;break;case 8:e.incapacitated=!e.incapacitated;break;case 9:e.invisible=!e.invisible;break;case 10:e.paralyzed=!e.paralyzed;break;case 11:e.petrified=!e.petrified;break;case 12:e.poisoned=!e.poisoned;break;case 13:e.prone=!e.prone;break;case 14:e.restrained=!e.restrained;break;case 15:e.stunned=!e.stunned;break;case 16:e.unconcious=!e.unconcious}localStorage.setItem(`${e.id}`,JSON.stringify(e))},e.deleteHero=function(e,t){let n=t.indexOf(e);t.splice(n,1),localStorage.removeItem(`${e.id}`)}}]),app.directive("adderValidator",["appService",function(e){return{link:function(t,n,i){let l=n[0],a=document.querySelector("#charNameAdd").firstElementChild,r=document.querySelector("#charHpAdd").firstElementChild,o=document.querySelector("#adderPopup");o.style.display="none",l.onclick=function(){if(e.char.name){if(e.char.hitPoints)return;o.style.display="block";new Popper(r,o,{placement:"top"});setTimeout(function(){o.style.display="none"},5e3)}else{o.style.display="block";new Popper(a,o,{placement:"top"});setTimeout(function(){o.style.display="none"},5e3)}}}}}]),app.directive("characterCopyValidator",["appService",function(e){return{link:function(t,n,i){let l,a,r=n[0],o=r.nextElementSibling,s=r.nextElementSibling.nextElementSibling,c=r.nextElementSibling.nextElementSibling.nextElementSibling;s.style.display="none",c.style.display="none",r.onclick=function(){if(r.classList.contains("heroCopy")?(l=t.heroesToAdd,a=e.playerChars):r.classList.contains("enemyCopy")&&(l=t.enemiesToAdd,a=e.enemyChars),a[0])if(void 0===l){s.style.display="block";new Popper(o,s,{placement:"top"});setTimeout(function(){s.style.display="none"},5e3)}else"block"===s.style.display&&(s.style.display="none");else if(!a[0]){"block"===s.style.display&&(s.style.display="none"),c.style.display="block";new Popper(o,c,{placement:"top"});setTimeout(function(){c.style.display="none"},5e3)}}}}}]),app.directive("charInputBlur",function(){return{link:function(e,t,n){let i=t[0],l=i.previousElementSibling,a=i.parentElement.parentElement.firstElementChild;i.onblur=function(){if(""===this.value){this.focus(),a.style.display="block";new Popper(i,a,{placement:"top"})}else"block"===a.style.display&&(a.style.display="none"),l.style.display="block",i.style.display="none"}}}}),app.directive("charInputFocus",function(){return{link:function(e,t,n){let i=t[0],l=i.nextElementSibling;l.style.display="none",i.onclick=function(e){i.style.display="none",l.style.display="block",l.focus()}}}}),app.directive("clearConfirm",function(){return{link:function(e,t,n){let i=t[0],l=i.nextElementSibling;l.style.display="none",i.onclick=function(){l.style.display="block";new Popper(i,l,{placement:"top"})}}}}),app.directive("deleteConfirm",function(){return{link:function(e,t,n){let i=t[0],l=i.nextElementSibling;l.style.display="none",i.onclick=function(){l.style.display="block";new Popper(i,l,{placement:"top"})}}}}),app.directive("editAll",function(){return{link:function(e,t,n){let i=t[0],l=i.nextElementSibling,a=i.parentElement.previousElementSibling.previousElementSibling.firstElementChild,r=a.nextElementSibling,o=r.nextElementSibling.nextElementSibling,s=o.nextElementSibling,c=i.parentElement.previousElementSibling.firstElementChild,p=c.nextElementSibling,d=p.nextElementSibling,m=d.nextElementSibling;l.style.display="none",i.onclick=function(e){a.style.display="none",o.style.display="none",c.style.display="none",d.style.display="none",i.style.display="none",r.style.display="block",s.style.display="block",p.style.display="block",m.style.display="block",l.style.display="block"}}}}),app.directive("hideClearPopup",function(){return{link:function(e,t,n){let i=t[0],l=i.parentElement.parentElement;i.onclick=function(){l.style.display="none"}}}}),app.directive("hideDeletePopup",function(){return{link:function(e,t,n){let i=t[0],l=i.parentElement.parentElement;i.onclick=function(){l.style.display="none"}}}}),app.directive("initInputFocus",function(){return{link:function(e,t,n){t.on("click",function(e){this.nextElementSibling.firstElementChild.focus()})}}}),app.directive("saveAll",function(){return{link:function(e,t,n){let i=t[0],l=i.previousElementSibling,a=i.parentElement.previousElementSibling.previousElementSibling.firstElementChild,r=a.nextElementSibling,o=r.nextElementSibling.nextElementSibling,s=o.nextElementSibling,c=i.parentElement.previousElementSibling.firstElementChild,p=c.nextElementSibling,d=p.nextElementSibling,m=d.nextElementSibling;i.onclick=function(e){""!==r.value&&""!==s.value&&""!==p.value&&""!==m.value&&(a.style.display="block",o.style.display="block",c.style.display="block",d.style.display="block",l.style.display="block",r.style.display="none",s.style.display="none",p.style.display="none",m.style.display="none",i.style.display="none")}}}}),app.directive("saveValidation",function(){return{link:function(e,t,n){let i=t[0],l=i.parentElement.previousElementSibling.previousElementSibling.firstElementChild.nextElementSibling,a=l.nextElementSibling.nextElementSibling.nextElementSibling,r=i.parentElement.previousElementSibling.firstElementChild.nextElementSibling,o=r.nextElementSibling.nextElementSibling,s=l.nextElementSibling,c=i.parentElement.parentElement.firstElementChild;s.style.display="none",c.style.display="none",i.onclick=function(){if(""===e.char.name){s.style.display="block";new Popper(l,s,{placement:"top"});setTimeout(function(){s.style.display="none"},5e3)}else if(null===e.char.armorClass){c.style.display="block";new Popper(a,c,{placement:"top"});setTimeout(function(){c.style.display="none"},5e3)}else if(null===e.char.maxHp){c.style.display="block";new Popper(r,c,{placement:"top"});setTimeout(function(){c.style.display="none"},5e3)}else{if(null!==e.char.hitPoints)return;c.style.display="block";new Popper(o,c,{placement:"top"});setTimeout(function(){c.style.display="none"},5e3)}}}}}),app.directive("stopPropagation",function(){return{link:function(e,t,n){t.on("click",function(e){e.stopPropagation()})}}}),app.directive("adder",[function(){return{templateUrl:"../../views/adder.tpl.html",controller:"adderCtrl",replace:!1}}]),app.directive("characters",[function(){return{templateUrl:"../../views/characters.tpl.html",controller:"characterCtrl",replace:!1}}]),app.directive("enemy",[function(){return{templateUrl:"../../views/enemy.tpl.html",controller:"enemyCtrl",replace:!1}}]),app.directive("initiative",[function(){return{templateUrl:"../../views/initiative.tpl.html",controller:"initiativeCtrl",replace:!1}}]),app.directive("player",[function(){return{templateUrl:"../../views/player.tpl.html",controller:"playerCtrl",replace:!1}}]);